#!/usr/bin/perl

use strict;
use warnings;
use Getopt::Long qw(GetOptions);

my $help = 0;
GetOptions("help" => \$help) or help();
help() if $help;

my $file = $ARGV[0] || help();
my $time = $ARGV[1] || help();

my $end = $ARGV[2] ? " -to \"$ARGV[2]\" " : '';

unless (-e $file) {
    print "Can't find file '$file'\n";
    help();
}

unless ($file =~ /\.mp4$/) {
    print "That's not an mp4 file. Refusing to trim it.\n";
    help();
}

$file =~ s/\.mp4$//;
my $orig = $file . ".mp4";
my $trimmed = $file . "_edit.mp4";
my $bak = $file . "_bak.mp4";

# ok, now the nasty work
qx/ffmpeg -noaccurate_seek -i $orig -ss "$time" $end -c copy $trimmed/;
qx/mv $orig $bak/;
qx/mv $trimmed $orig/;

sub help  {

print qq~
Trims the first n seconds from a raw video. Preview and determine when the actual content starts
Usage: $0 FILE (must be mp4) TIME
Eg: $0 openofficeT1514.mp4 00:00:14

You can also optionally provide an end time to trim dead air at the end.

Times should be provided as hh:mm:ss (eg '00:01:34')

NOTE: Your original file will be preserved as whatever_bak.mp4, in case
you screw up.

WARNING: This script does not, at this time, validate your time format,
so it will probably just silently fail if you do that wrong. Error
checking to be added soon.

~;
    exit();
}
